---
layout: post
category: tech
title:  "RFC8017 PKCS#1 RSA"
tagline: ""
tags: [ "rfc", "pkcs", "rsa" ] 
---
{% include JB/setup %}

* TOC
{:toc}

# Key Types 

注意，RSA2048，其中的2048指的是modulus的length

    p = r_1,  q = r_2

    q * qInv == 1 (mod p)

    e * d_i == 1 (mod (r_i - 1))

    R_i * t_i == 1 (mod r_i)

    R_i = r_1 * r_2 * ... * r_(i-1)


# Encryption Schemes

[RSAES-OAEP](https://tools.ietf.org/html/rfc8017#section-7.1) 加入了seed参与运算, 优于 [RSAES-PKCS1-v1_5](https://tools.ietf.org/html/rfc8017#section-7.2.1)。

# Signature Scheme

参考 [RSA-PSS – Provable secure RSA Signatures](https://rsapss.hboeck.de/rsapss.pdf)

PSS: Probabilistic Signature Scheme 

[RSASSA-PSS](https://tools.ietf.org/html/rfc8017#section-8.1.1) 加入了salt参与运算，每次运算得到的signature值各自不同，优于 [RSASSA-PKCS1-v1_5](https://tools.ietf.org/html/rfc8017#section-8.2.1)。

# Encoding Methods for Signatures with Appendix

[EMSA-PSS](https://tools.ietf.org/html/rfc8017#section-9.1) 优于 [EMSA-PKCS1-v1_5](https://tools.ietf.org/html/rfc8017#section-9.2)，注意这是hash型的单向变换

关键参数包含 hash function, mgf (mask generation function), salt length

[Mask Generation Functions](https://tools.ietf.org/html/rfc8017#page-66) 掩码生成，默认MGF1使用的hash函数为sha1。

PSS的实现代码可以参考 [Crypt::RSA::SS::PSS](https://metacpan.org/source/Crypt::RSA::SS::PSS)，不过需要注意，源码中的 ``$params{Message} || $params{Plaintext}`` 其实相当于[EMSA-PSS](https://tools.ietf.org/html/rfc8017#section-9.1) 中的mHash，而不是M。

# ASN.1 Syntax

[RSA Key Representation](https://tools.ietf.org/html/rfc8017#appendix-A.1) 各项参数说明，n/p/q/e/d/...

    RSAPublicKey ::= SEQUENCE {
                modulus           INTEGER,  -- n
                publicExponent    INTEGER   -- e
    }

    RSAPrivateKey ::= SEQUENCE {
                 version           Version,
                 modulus           INTEGER,  -- n
                 publicExponent    INTEGER,  -- e
                 privateExponent   INTEGER,  -- d
                 prime1            INTEGER,  -- p
                 prime2            INTEGER,  -- q
                 exponent1         INTEGER,  -- d mod (p-1)
                 exponent2         INTEGER,  -- d mod (q-1)
                 coefficient       INTEGER,  -- (inverse of q) mod p
                 otherPrimeInfos   OtherPrimeInfos OPTIONAL
             }

    OtherPrimeInfos ::= SEQUENCE SIZE(1..MAX) OF OtherPrimeInfo

    OtherPrimeInfo ::= SEQUENCE {
                prime             INTEGER,  -- ri
                exponent          INTEGER,  -- di
                coefficient       INTEGER   -- ti
    }
